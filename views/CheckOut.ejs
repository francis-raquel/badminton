<html>
  <head>
    <%- include('partials/header.ejs') %>
    <script>
      function updateTotal(index, price) {
        const qty = document.getElementById('qty-' + index).value;
        const total = qty * price;
        document.getElementById('total-' + index).innerText = '$ ' + total.toFixed(2);
        calculateSubtotal();
      }

      function calculateSubtotal() {
        let subtotal = 0;
        const totalFields = document.querySelectorAll('[id^="total-"]');
        totalFields.forEach(field => {
          const value = parseFloat(field.innerText.replace('$', ''));
          subtotal += isNaN(value) ? 0 : value;
        });
        document.getElementById('subtotal').innerText = '$ ' + subtotal.toFixed(2);
      }
    </script>
  </head>
  <body>
    <%- include('partials/navbar1.ejs') %>

    <div class="container">
      <h1>Order list</h1>
      <form action="/submit-order" method="POST">
        <table class="table table-bordered mt-4">
          <thead>
            <tr>
              <th>id</th>
              <th>type</th>
              <th>name</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total Price</th>
            </tr>
          </thead>
          <tbody>
            <% menuData.forEach((item, index) => { %>
              <tr>
                <td><%= item.id%></td>
                <td><%= item.type %></td>
                <td><%= item.name %></td>
                <td>$ <%= item.Price.toFixed(2) %></td>
                <td>
                  <input type="number" name="qty[]" id="qty-<%= index %>" value="0" min="0"
                    onchange="updateTotal(<%= index %>, <%= item.Price %>)">
                  <input type="hidden" name="item_no[]" value="<%= item.Item_No %>">
                </td>
                <td id="total-<%= index %>">$ 0.00</td>
              </tr>
            <% }) %>
            <tr>
              <td colspan="5" class="text-end"><strong>Subtotal:</strong></td>
              <td id="subtotal">$ 0.00</td>
            </tr>
          </tbody>
        </table>
        </form>
    </div>
  
  <div class="text-end mb-3 mt-4">
  <button 
    type="button" 
    class="btn btn-success px-4 py-2 rounded-pill shadow-sm fw-semibold" 
    onclick="goToPlaceOrder()"
 >
    ðŸ›’ Place Order
  </button>
</div>

<script>
  function goToPlaceOrder() {
    const subtotalText = document.getElementById('subtotal').innerText;
    const subtotalValue = parseFloat(subtotalText.replace('$', '')) || 0;
    window.location.href = `/place-order?subtotal=${subtotalValue.toFixed(2)}`;
  }
</script>

    <%- include('partials/footer.ejs') %>
  </body>
</html>
